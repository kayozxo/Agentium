<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <meta
      name="color-scheme"
      content="dark"
    />
    <title>Agentium</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="/static/styles.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
  </head>
  <body>
<div class="bg-layers" aria-hidden="true"></div>
    <div class="container">
      <header
        class="header"
        id="headerTop"
      >
        <div class="logo">
          <div class="logo-icon">
            <svg
              width="150"
              height="150"
              viewBox="0 0 150 150"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="75"
                cy="75"
                r="6"
                fill="#121212"
              />
              <ellipse
                cx="75"
                cy="75"
                rx="40"
                ry="20"
                stroke="#121212"
                stroke-width="2"
                fill="none"
              />
              <ellipse
                cx="75"
                cy="75"
                rx="20"
                ry="40"
                stroke="#121212"
                stroke-width="2"
                fill="none"
                transform="rotate(45 75 75)"
              />
              <ellipse
                cx="75"
                cy="75"
                rx="20"
                ry="40"
                stroke="#121212"
                stroke-width="2"
                fill="none"
                transform="rotate(-45 75 75)"
              />
            </svg>
          </div>
          Agentium
        </div>
      </header>

      <main class="main-content">
        <div
          class="hero-section"
          id="heroSection"
        >
          <h1 class="hero-title">Chat Smarter, Not Harder</h1>
          <p class="hero-subtitle">
            Access to task-specific agents all in one chat interface.
          </p>
        </div>

        <div
          class="chat-container"
          id="chatContainer"
        >
          <div class="chat-header">
            <div
              class="chat-header-icon"
              id="chatHeaderIcon"
            >
              ðŸ’¬
            </div>
            <div class="chat-header-text">
              <h3 id="agentTitle">General Chat</h3>
              <p id="agentDescription">Ask me anything!</p>
            </div>
          </div>

          <div
            class="messages-container"
            id="messages"
            aria-live="polite"
          >
            <div class="welcome-message">
              <h4>Welcome to AI Agent Hub!</h4>
              <p>Select an agent and start your conversation.</p>
            </div>
          </div>
        </div>

        <div class="input-section">
          <div class="input-controls">
            <div
              class="custom-dropdown"
              id="agentDropdown"
            >
              <button
                class="dropdown-button"
                id="dropdownButton"
              >
                <div
                  class="dropdown-selected"
                  id="dropdownSelected"
                >
                  <i class="bi bi-chat-dots"></i>
                  <span>General</span>
                </div>
                <i class="bi bi-caret-down-fill dropdown-arrow"></i>
              </button>
              <div
                class="dropdown-menu"
                id="dropdownMenu"
              >
                <div
                  class="dropdown-option selected"
                  data-value="general"
                >
                  <i class="bi bi-chat-dots"></i>
                  <span>General</span>
                </div>
                <div
                  class="dropdown-option"
                  data-value="web"
                >
                  <i class="bi bi-globe2"></i>
                  <span>Web Search</span>
                </div>
                <div
                  class="dropdown-option"
                  data-value="youtube"
                >
                  <i class="bi bi-youtube"></i>
                  <span>YouTube</span>
                </div>
                <div
                  class="dropdown-option"
                  data-value="articles"
                >
                  <i class="bi bi-file-text"></i>
                  <span>Articles</span>
                </div>
                <div
                  class="dropdown-option"
                  data-value="linkedin"
                >
                  <i class="bi bi-linkedin"></i>
                  <span>LinkedIn</span>
                </div>
                <div
                  class="dropdown-option"
                  data-value="finance"
                >
                  <i class="bi bi-currency-dollar"></i>
                  <span>Finance</span>
                </div>
              </div>
            </div>

            <div
              class="file-upload-container"
              id="fileUploadContainer"
            >
              <button
                class="file-upload-btn"
                id="imageUploadBtn"
                title="Upload images (General chat only)"
              >
                <i class="bi bi-image"></i> Image
                <input
                  type="file"
                  class="file-input"
                  id="imageInput"
                  accept="image/*"
                  multiple
                />
              </button>
              <button
                class="file-upload-btn"
                id="fileUploadBtn"
                title="Upload files (General chat only)"
              >
                <i class="bi bi-file-earmark"></i> File
                <input
                  type="file"
                  class="file-input"
                  id="fileInput"
                  multiple
                />
              </button>
            </div>
          </div>

          <div
            class="uploaded-files"
            id="uploadedFiles"
          ></div>

          <div class="input-wrapper">
            <textarea
              class="chat-input"
              id="messageInput"
              placeholder="Ask Agentium to create a LinkedIn post about..."
              rows="1"
            ></textarea>
            <button
              class="send-button"
              id="sendButton"
              disabled
            >
              <i class="bi bi-arrow-up"></i>
            </button>
          </div>
        </div>
      </main>
    </div>
  </div>

    <script>
      class CustomDropdown {
        constructor(element) {
          this.dropdown = element
          this.button = element.querySelector('.dropdown-button')
          this.menu = element.querySelector('.dropdown-menu')
          this.selected = element.querySelector('.dropdown-selected')
          this.options = element.querySelectorAll('.dropdown-option')
          this.isOpen = false

          this.init()
        }

        init() {
          // Toggle dropdown on button click
          this.button.addEventListener('click', (e) => {
            e.stopPropagation()
            this.toggle()
          })

          // Handle option selection
          this.options.forEach((option) => {
            option.addEventListener('click', (e) => {
              e.stopPropagation()
              this.selectOption(option)
            })
          })

          // Close dropdown when clicking outside
          document.addEventListener('click', () => {
            this.close()
          })

          // Close dropdown on escape key
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
              this.close()
            }
          })
        }

        toggle() {
          if (this.isOpen) {
            this.close()
          } else {
            this.open()
          }
        }

        open() {
          this.isOpen = true
          this.button.classList.add('active')
          this.menu.classList.add('active')
        }

        close() {
          this.isOpen = false
          this.button.classList.remove('active')
          this.menu.classList.remove('active')
        }

        selectOption(option) {
          // Remove selected class from all options
          this.options.forEach((opt) => opt.classList.remove('selected'))

          // Add selected class to clicked option
          option.classList.add('selected')

          // Update the button display
          const icon = option.querySelector('i').className
          const text = option.querySelector('span').textContent

          this.selected.innerHTML = `
            <i class="${icon}"></i>
            <span>${text}</span>
          `

          // Close dropdown
          this.close()

          // Trigger change event
          const changeEvent = new CustomEvent('change', {
            detail: {
              value: option.dataset.value,
              text: text,
              icon: icon,
            },
          })
          this.dropdown.dispatchEvent(changeEvent)
        }

        getValue() {
          const selectedOption = this.dropdown.querySelector(
            '.dropdown-option.selected',
          )
          return selectedOption ? selectedOption.dataset.value : null
        }

        setValue(value) {
          const option = this.dropdown.querySelector(`[data-value="${value}"]`)
          if (option) {
            this.selectOption(option)
          }
        }
      }

      class ChatApp {
        constructor() {
          this.currentAgent = 'general'
          this.apiUrl = 'http://localhost:8000'
          this.messages = []
          this.isLoading = false
          this.uploadedFiles = []
          this.isChatStarted = false
          this.hasImages = false // Track if there are uploaded images

          this.initializeElements()
          this.initializeDropdown()
          this.bindEvents()
          this.updatePlaceholder()
          this.updateFileUploadVisibility()
        }

        initializeElements() {
          this.heroSection = document.getElementById('heroSection')
          this.headerTop = document.getElementById('headerTop')
          this.chatContainer = document.getElementById('chatContainer')
          this.messagesContainer = document.getElementById('messages')
          this.messageInput = document.getElementById('messageInput')
          this.sendButton = document.getElementById('sendButton')
          this.agentTitle = document.getElementById('agentTitle')
          this.agentDescription = document.getElementById('agentDescription')
          this.chatHeaderIcon = document.getElementById('chatHeaderIcon')
          this.imageInput = document.getElementById('imageInput')
          this.fileInput = document.getElementById('fileInput')
          this.imageUploadBtn = document.getElementById('imageUploadBtn')
          this.fileUploadBtn = document.getElementById('fileUploadBtn')
          this.uploadedFilesContainer = document.getElementById('uploadedFiles')
          this.fileUploadContainer = document.getElementById(
            'fileUploadContainer',
          )
          this.inputSectionEl = document.querySelector('.input-section');
        }

        initializeDropdown() {
          const dropdownElement = document.getElementById('agentDropdown')
          this.agentDropdown = new CustomDropdown(dropdownElement)

          // Listen for dropdown changes
          dropdownElement.addEventListener('change', (e) => {
            this.selectAgent(e.detail.value)
          })
        }

        bindEvents() {
          // File uploads
          this.imageUploadBtn.addEventListener('click', () => {
            if (this.currentAgent === 'general') {
              this.imageInput.click()
            } else {
              this.showNotification(
                'Image upload is only available in General chat mode',
              )
            }
          })

          this.fileUploadBtn.addEventListener('click', () => {
            if (this.currentAgent === 'general') {
              this.fileInput.click()
            } else {
              this.showNotification(
                'File upload is only available in General chat mode',
              )
            }
          })

          this.imageInput.addEventListener('change', (e) => {
            this.handleFileUpload(e.target.files, 'image')
          })

          this.fileInput.addEventListener('change', (e) => {
            this.handleFileUpload(e.target.files, 'file')
          })

          // Send message
          this.sendButton.addEventListener('click', () => this.sendMessage())

          this.messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault()
              this.sendMessage()
            }
          })

          // Auto-resize textarea and enable/disable send button
          this.messageInput.addEventListener('input', () => {
            this.autoResizeTextarea()
            this.sendButton.disabled =
              !this.messageInput.value.trim() && this.uploadedFiles.length === 0
          })
        }

        updateFileUploadVisibility() {
          const isGeneral = this.currentAgent === 'general'

          // Show/hide file upload container
          this.fileUploadContainer.style.display = isGeneral ? 'flex' : 'none'

          // Update button states and tooltips
          if (!isGeneral) {
            this.imageUploadBtn.disabled = true
            this.fileUploadBtn.disabled = true
            this.imageUploadBtn.title =
              'Image upload is only available in General chat'
            this.fileUploadBtn.title =
              'File upload is only available in General chat'
          } else {
            this.imageUploadBtn.disabled = false
            this.fileUploadBtn.disabled = false
            this.imageUploadBtn.title = 'Upload images'
            this.fileUploadBtn.title = 'Upload files'
          }
        }

        showNotification(message) {
          // Create notification element
          const notification = document.createElement('div')
          notification.className = 'notification'
          notification.textContent = message
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 14px;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
          `

          // Add animation styles
          const style = document.createElement('style')
          style.textContent = `
            @keyframes slideIn {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
          `
          document.head.appendChild(style)

          document.body.appendChild(notification)

          // Remove notification after 3 seconds
          setTimeout(() => {
            notification.style.animation = 'slideIn 0.3s ease-out reverse'
            setTimeout(() => {
              if (notification.parentNode) {
                notification.parentNode.removeChild(notification)
              }
            }, 300)
          }, 3000)
        }

        startChat() {
          this.isChatStarted = true

          if (this.heroSection) this.heroSection.style.display = 'none'
          if (this.headerTop) this.headerTop.style.display = 'none'
          if (this.chatContainer) this.chatContainer.style.display = 'block'
        }

        selectAgent(agentType) {
          // If switching away from general and there are files, clear them and warn user
          if (
            this.currentAgent === 'general' &&
            agentType !== 'general' &&
            this.uploadedFiles.length > 0
          ) {
            this.showNotification(
              'Files cleared when switching from General chat',
            )
            this.uploadedFiles = []
            this.renderUploadedFiles()
            this.hasImages = false
          }

          this.currentAgent = agentType
          const agentInfo = this.getAgentInfo(agentType)
          this.agentTitle.textContent = agentInfo.title
          this.agentDescription.textContent = agentInfo.description

          // Clear and add Bootstrap icon
          this.chatHeaderIcon.innerHTML = ''
          const icon = document.createElement('i')
          icon.className = agentInfo.icon
          this.chatHeaderIcon.appendChild(icon)

          this.updatePlaceholder()
          this.updateFileUploadVisibility()

          if (this.isChatStarted) {
            this.clearMessages()
          }
        }

        updatePlaceholder() {
          const placeholders = {
            general: 'Ask me anything...',
            web: 'Search the web...',
            youtube: 'Find YouTube videos about...',
            articles: 'Research articles on...',
            linkedin: 'Find LinkedIn insights about...',
            finance: 'Get financial data for...',
          }
          this.messageInput.placeholder =
            placeholders[this.currentAgent] || 'Type your message...'
        }

        getAgentInfo(agentType) {
          const agentInfoMap = {
            general: {
              title: 'General Chat',
              description: 'Ask me anything!',
              icon: 'bi bi-chat-dots',
            },
            web: {
              title: 'Web Agent',
              description: 'Search and browse the web',
              icon: 'bi bi-globe2',
            },
            youtube: {
              title: 'YouTube Agent',
              description: 'Find YouTube content',
              icon: 'bi bi-youtube',
            },
            articles: {
              title: 'Articles Agent',
              description: 'Research articles',
              icon: 'bi bi-file-text',
            },
            linkedin: {
              title: 'LinkedIn Agent',
              description: 'Professional insights',
              icon: 'bi bi-linkedin',
            },
            finance: {
              title: 'Finance Agent',
              description: 'Financial analysis',
              icon: 'bi bi-currency-dollar',
            },
          }
          return agentInfoMap[agentType] || agentInfoMap.general
        }

        handleFileUpload(files, type) {
          if (this.currentAgent !== 'general') {
            this.showNotification(
              'File upload is only available in General chat mode',
            )
            return
          }

          Array.from(files).forEach((file) => {
            const fileObj = {
              id: Date.now() + Math.random(),
              file: file,
              type: type,
              name: file.name,
            }
            this.uploadedFiles.push(fileObj)

            // Track if we have images for vision model switching
            if (type === 'image') {
              this.hasImages = true
            }
          })

          this.renderUploadedFiles()
          this.updateHasFilesClass();
          this.sendButton.disabled =
            !this.messageInput.value.trim() && this.uploadedFiles.length === 0
        }

        renderUploadedFiles() {
          this.uploadedFilesContainer.innerHTML = ''

          this.uploadedFiles.forEach((fileObj) => {
            const chip = document.createElement('div')
            chip.className = 'file-chip'
            chip.innerHTML = `
              <span>${
                fileObj.type === 'image'
                  ? '<i class="bi bi-image"></i>'
                  : '<i class="bi bi-file-earmark"></i>'
              } ${fileObj.name}</span>
              <span class="remove-file" data-id="${fileObj.id}">Ã—</span>
            `

            chip.querySelector('.remove-file').addEventListener('click', () => {
              this.removeFile(fileObj.id)
            })

            this.uploadedFilesContainer.appendChild(chip)
          })
        }

        removeFile(fileId) {
          this.uploadedFiles = this.uploadedFiles.filter((f) => f.id !== fileId)

          // Check if we still have images after removal
          this.hasImages = this.uploadedFiles.some((f) => f.type === 'image')

          this.renderUploadedFiles()
          this.updateHasFilesClass();
          this.sendButton.disabled =
            !this.messageInput.value.trim() && this.uploadedFiles.length === 0
        }

        updateHasFilesClass() {
          const has = this.uploadedFiles.length > 0;
          this.inputSectionEl ||= document.querySelector('.input-section');
          if (!this.inputSectionEl) return;
          this.inputSectionEl.classList.toggle('has-files', has);
        }

        autoResizeTextarea() {
          this.messageInput.style.height = 'auto'
          this.messageInput.style.height =
            Math.min(this.messageInput.scrollHeight, 120) + 'px'
        }

        async sendMessage() {
          const message = this.messageInput.value.trim()
          if (this.isLoading) return
          if (!message && this.uploadedFiles.length === 0) return

          if (!this.isChatStarted) {
            this.startChat()
          }

          // Prepare files for upload if any
          const filesToSend = []
          if (this.uploadedFiles.length > 0) {
            for (const fileObj of this.uploadedFiles) {
              if (fileObj.type === 'image') {
                // Convert image to base64 for vision model
                const base64 = await this.fileToBase64(fileObj.file)
                filesToSend.push({
                  type: 'image',
                  name: fileObj.name,
                  data: base64,
                  mimeType: fileObj.file.type,
                })
              } else {
                // Handle other file types as needed
                filesToSend.push({
                  type: 'file',
                  name: fileObj.name,
                  size: fileObj.file.size,
                  mimeType: fileObj.file.type,
                })
              }
            }
          }

          // Add user message to messages array
          const userMessage = {
            role: 'user',
            content: message || 'Files uploaded',
            timestamp: new Date().toISOString(),
            files: filesToSend,
          }
          this.messages.push(userMessage)

          // Limit conversation history before sending
          this.limitConversationHistory()

          // Add user message to UI
          let displayMessage = message
          if (this.uploadedFiles.length > 0) {
            const fileList = this.uploadedFiles.map((f) => f.name).join(', ')
            displayMessage = `${message}\nðŸ“Ž Files: ${fileList}`
          }
          this.addMessage(displayMessage || 'ðŸ“Ž Files uploaded', 'user')

          // Clear input
          this.messageInput.value = ''
          const hasImagesBeforeClear = this.hasImages
          this.uploadedFiles = []
          this.hasImages = false
          this.renderUploadedFiles()
          this.updateHasFilesClass();
          this.sendButton.disabled = true
          this.autoResizeTextarea()

          // Show loading
          this.showLoading()

          try {
            const requestBody = {
              agent: this.currentAgent,
              query: message || 'Files uploaded',
              messages: this.messages,
              useVisionModel:
                hasImagesBeforeClear && this.currentAgent === 'general', // Flag for vision model
              files: filesToSend,
            }

            const response = await fetch(`${this.apiUrl}/agent/ask`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestBody),
            })

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`)
            }

            const data = await response.json()

            // Add AI response to messages array
            const aiMessage = {
              role: 'assistant',
              content: data.response,
              timestamp: new Date().toISOString(),
            }
            this.messages.push(aiMessage)

            this.hideLoading()
            this.addMessage(data.response, 'bot')
          } catch (error) {
            this.hideLoading()
            this.showError(`Failed to get response: ${error.message}`)

            // Remove the user message from history if API call failed
            this.messages.pop()
          }
        }

        // Helper function to convert file to base64
        fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader()
            reader.onload = () => {
              // Remove the data URL prefix to get just the base64 string
              const base64 = reader.result.split(',')[1]
              resolve(base64)
            }
            reader.onerror = reject
            reader.readAsDataURL(file)
          })
        }

        limitConversationHistory() {
          const maxMessages = 20
          if (this.messages.length > maxMessages) {
            this.messages = this.messages.slice(-maxMessages)
          }
        }

        addMessage(content, sender) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `message ${sender}`;

          const avatar = document.createElement('div');
          avatar.className = 'message-avatar';
          avatar.textContent = sender === 'user' ? 'U' : 'AI';

          const messageContent = document.createElement('div');
          messageContent.className = 'message-content';

          // Detect "Files: ..." pattern and split text from files
          let textPart = content;
          let filesPart = null;
          const filesMatch = content.match(/(?:^|\n)ðŸ“Ž\sFiles:\s(.+)$/i);
          if (filesMatch) {
          textPart = content.replace(filesMatch[0], '').trim();
          filesPart = filesMatch[1]
          .split(',')
          .map(s => s.trim())
          .filter(Boolean);
          }

          // Main text (markdown-rendered)
          const formatted = this.formatMessage(textPart || '');
          messageContent.innerHTML = formatted || '';

          // If files present, render as chips below
          if (filesPart && filesPart.length) {
          const filesRow = document.createElement('div');
          filesRow.className = 'message-files';
          filesPart.forEach(name => {
          const chip = document.createElement('span');
          chip.className = 'message-file-chip';
          chip.innerHTML = `<i class="bi bi-paperclip"></i><span title="${name}">${name}</span>`;
          filesRow.appendChild(chip);
          });
          messageContent.appendChild(filesRow);
          }

          messageDiv.appendChild(avatar);
          messageDiv.appendChild(messageContent);

          const welcomeMessage = this.messagesContainer.querySelector('.welcome-message');
          if (welcomeMessage) welcomeMessage.remove();

          this.messagesContainer.appendChild(messageDiv);

          // Optional: add copy button to code blocks (if you added earlier snippet)
          messageContent.querySelectorAll('pre').forEach((pre) => {
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.textContent = 'Copy';
          btn.addEventListener('click', () => {
          const code = pre.innerText;
          navigator.clipboard.writeText(code).then(() => {
          btn.textContent = 'Copied';
          setTimeout(() => (btn.textContent = 'Copy'), 1200);
          });
          });
          pre.appendChild(btn);
          });

          this.scrollToBottom();
        }

        formatMessage(content) {
          const renderer = new marked.Renderer()

          renderer.list = function (body, ordered) {
            const type = ordered ? 'ol' : 'ul'
            return `<${type} style="margin: 8px 0; padding-left: 20px; list-style-position: outside;">${body}</${type}>`
          }

          renderer.listitem = function (text) {
            return `<li style="margin-bottom: 4px;">${text}</li>`
          }

          renderer.link = function (href, title, text) {
            return `<a href="${href}" target="_blank" style="color: #ffbe1a; text-decoration: underline; cursor: pointer;"${
              title ? ` title="${title}"` : ''
            }>${text}</a>`
          }
          renderer.heading = function (text, level) {
            const colors = {
              1: '#ffbe1a', // H1 color
              2: '#ffbe1a', // H2 color
              3: '#ffbe1a', // H3 color
              4: '#ffbe1a', // H4 color
              5: '#ffbe1a', // H5 color
              6: '#ffbe1a', // H6 color
            }

            const fontSize = {
              1: '24px',
              2: '20px',
              3: '18px',
              4: '16px',
              5: '14px',
              6: '12px',
            }

            return `<h${level} style="color: ${
              colors[level] || '#ffbe1a'
            }; font-size: ${
              fontSize[level]
            }; font-weight: 600; margin: 16px 0 8px 0;">${text}</h${level}>`
          }
          return marked.parse(content, {
            renderer: renderer,
            breaks: true,
            gfm: true,
          })
        }

        showLoading() {
          this.isLoading = true
          const loadingDiv = document.createElement('div')
          loadingDiv.className = 'message bot'
          loadingDiv.id = 'loading-message'

          const avatar = document.createElement('div')
          avatar.className = 'message-avatar'
          avatar.textContent = 'AI'

          const loadingContent = document.createElement('div')
          loadingContent.className = 'message-content'
          loadingContent.innerHTML = `
            <div class="loading">
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
              <div class="loading-dot"></div>
            </div>
          `

          loadingDiv.appendChild(avatar)
          loadingDiv.appendChild(loadingContent)
          this.messagesContainer.appendChild(loadingDiv)
          this.scrollToBottom()
        }

        hideLoading() {
          this.isLoading = false
          const loadingMessage = document.getElementById('loading-message')
          if (loadingMessage) {
            loadingMessage.remove()
          }
        }

        showError(message) {
          const errorDiv = document.createElement('div')
          errorDiv.className = 'error-message'
          errorDiv.textContent = message
          this.messagesContainer.appendChild(errorDiv)
          this.scrollToBottom()

          setTimeout(() => {
            errorDiv.remove()
          }, 5000)
        }

        clearMessages() {
          this.messages = []
          this.messagesContainer.innerHTML = `
            <div class="welcome-message">
              <h4>Switched to ${this.getAgentInfo(this.currentAgent).title}</h4>
              <p>${this.getAgentInfo(this.currentAgent).description}</p>
            </div>
          `
        }

        scrollToBottom() {
          this.messagesContainer.scrollTo({
            top: this.messagesContainer.scrollHeight,
            behavior: 'smooth',
          })
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        new ChatApp()
      })
    </script>
  </body>
</html>
